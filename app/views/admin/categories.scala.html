@(currentUser: User,
  categories: List[Category],
  versionForm: Form[Category])

@import helper._
@import helper.twitterBootstrap._

@admin.adminTemplate("Categories", currentUser) {

<div class="row">
    <div class="span3">
        <div class="adminBadge">
            <h4>Add new category</h4>
            @helper.form(routes.Categories.addNewCategory) {
                @helper.inputText(versionForm("name"))

                <button type="submit" class="btn">Add</button>

            }
        </div>
    </div>
    <div class="span8">
        <h4>List of Categories</h4>
        <table class="table table-striped">
            <tbody>
            @for(category <- categories) {
                <tr>
                    <td>
                        <a id="name-@category.id" href="@routes.Categories.categoryDetails(category.name)">@category.name</a>
                    </td>
                    <td>
                        <a href="javascript:editCategory('@category.id', $('#name-@category.id').text())">Edit</a></li>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>


<script type="text/javascript">
    $(function(){
        setAdminNavbar("Categories");
    });

    var onError = function(form, message) {
        editCategory(form.id, form.name, message);
    };

    var onSuccess = function(form, data) {
        var anchor = $('#name-' + form.id);
        var href = anchor.attr('href');
        href = href.substring(0, href.lastIndexOf('/') + 1) + form.name;
        $('#name-' + form.id).attr('href', href);
    }

    function editCategory(id, name, message) {
        message = (typeof message == 'undefined') ? '' : message;
        var template = _.template($('#editCategoryTemplate').html(),
                                  {id:id, name:name, message:message})
        editAdminSection(template,
                         onSuccess,
                         onError);
    }
</script>
<script type="underscore-template" id="editCategoryTemplate">
    <form>
        <input type="hidden" name="id" value="<%= id %>"/>
        <input type="hidden" name="targetUrl" value="@routes.Categories.update"/>
        <p><%= message %></p>
        <table class="formTable">
            <tr>
                <td><label for="name">Name</label></td>
                <td><input type="text" name="name" id="name" value="<%= name %>"/></td>
            </tr>
        </table>
    </form>
</script>
}