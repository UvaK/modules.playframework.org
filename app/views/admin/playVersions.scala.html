@(currentUser: User,
  playOneVersions: List[PlayVersion],
  playTwoVersions: List[PlayVersion],
  versionForm: Form[models.PlayVersion])

@displayVersion(playVersion: PlayVersion) = {
    <li><span id="name-@playVersion.id">@playVersion.name</span> - <span id="documentationUrl-@playVersion.id">@playVersion.documentationUrl</span> (<a href="javascript:editVersion('@playVersion.id', $('#name-@playVersion.id').text(), $('#documentationUrl-@playVersion.id').text())">Edit</a>)</li>
}

@admin.adminTemplate("Play versions", currentUser) {
<section>
    <div id="overviewArea">
        <h4>Play 1</h4>
        <ul>
            @for(playVersion <- playOneVersions) {
            @displayVersion(playVersion)
            }
        </ul>

        <h4>Play 2</h4>
        <ul>
            @for(playVersion <- playTwoVersions) {
            @displayVersion(playVersion)
            }
        </ul>
    </div>
    <div id="controlArea">
        <h3>Add new version</h3>
        @helper.form(routes.PlayVersions.addNewPlayVersion) {
        @helper.inputText(versionForm("name"))
        @helper.inputText(versionForm("documentationUrl"))
        <p>
            <button type="submit">Add</button>
        </p>
        }
    </div>
</section>
<script type="text/javascript">
    function editVersion(id, name, documentationUrl, message) {
        message = (typeof message == 'undefined') ? '' : message;
        var template = _.template($('#editVersionTemplate').html(),
                                  {id:id, name:name, documentationUrl:documentationUrl, message:message})
        $.prompt(template,
                 { buttons: { Update: true, Cancel: false },
                   callback: function(e,v,m,f) {
                       if (v) {
                           $.post('@routes.PlayVersions.update',
                                  {id:f.id, name:f.name, documentationUrl:f.documentationUrl})
                           .success(function(data, textStatus, jqXHR) {
                                        for (var key in f) {
                                            $('#' + key + '-' + id).text(f[key]);
                                        }
                                    })
                           .error(function(jqXHR, textStatus, errorThrown) {
                                      var messageJson = JSON.parse(jqXHR.responseText);
                                      var message = '';
                                      for (var key in messageJson) {
                                          message += (key + ': ' + messageJson[key] + '<br>');
                                      }

                                      editVersion(id, name, documentationUrl, message);
                                  });
                       }
                   }});
    }
</script>
<script type="underscore-template" id="editVersionTemplate">
    @helper.form(routes.PlayVersions.update) {
    <input type="hidden" name="id" value="<%= id %>"/>
    <p><%= message %></p>
    <table>
        <tr>
            <td>Name</td>
            <td><input type="text" name="name" value="<%= name %>"/></td>
        </tr>
        <tr>
            <td>Documentation URL</td>
            <td><input type="text" name="documentationUrl" value="<%= documentationUrl %>"/></td>
        </tr>
    </table>
    }
</script>
}
